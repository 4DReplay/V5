<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>4DReplay V5 - Camera Manager</title>
  <meta http-equiv="Cache-Control" content="no-store" />
  <!-- proxy-safe asset loader: works for /proxy/<node>/... and direct port -->
  <script>
  (function () {
    // e.g., /proxy/DMS-1/oms-system.html  =>  /proxy/DMS-1
    const m = location.pathname.match(/^\/proxy\/([^/]+)/);
    const PROXY_PREFIX = m ? "/proxy/" + encodeURIComponent(m[1]) : "";
    const bust = "?v=" + Date.now(); // cache-buster to avoid stale css/js

    const CSS_CANDIDATES = [
      PROXY_PREFIX + "/web/4d-common.css",
      "./4d-common.css",
    ];
    const JS_CANDIDATES = [
      PROXY_PREFIX + "/web/4d-common-style.js",
      "./4d-common-style.js",
    ];

    function injectCSS(list, i=0){
      if (i >= list.length) return;
      const el = document.createElement("link");
      el.rel = "stylesheet"; el.href = list[i] + bust;
      el.onerror = () => { console.warn("[CSS miss]", list[i]); injectCSS(list, i+1); };
      document.head.appendChild(el);
    }
    function injectJS(list, i=0){
      if (i >= list.length) return;
      const el = document.createElement("script");
      el.defer = true; el.src = list[i] + bust;
      el.onerror = () => { console.warn("[JS miss]", list[i]); injectJS(list, i+1); };
      document.head.appendChild(el);
    }
    injectCSS(CSS_CANDIDATES); injectJS(JS_CANDIDATES);
  })();
  </script>
</head>
<body>
  <!-- Title -->
  <h1 class="page-title">4DReplay V5 - Camera Manager</h1>

  <!-- Controls under title -->
  <div class="toolbar" style="justify-content:flex-start">
    <button id="btnRun" class="btn-secondary">🚀 Connect Cameras</button>
    <button id="btnSwAllReboot" class="btn-secondary" title="Reboot all switches">🔁 Restart Cameras</button>
    <label class="chip" style="margin-left:12px">
      <input type="checkbox" id="selAll" /> Select All Cameras
    </label>
    <small id="busy" class="muted"></small>
  </div>

  <!-- Hidden (kept for JS compatibility) -->
  <div style="display:none">
    <input id="camHost" type="text" value="127.0.0.1" />
    <input id="camPort" type="number" value="19765" />
    <input id="camMgmt" type="text" value="" />
    <button id="btnRefresh"></button>
    <small id="meta"></small>
  </div>

  <div class="panel" style="margin-top:16px">
    <h3 style="margin:0 0 6px; display:flex; align-items:center; justify-content:space-between;">
      <span>Switch Details</span>
      <span></span>
    </h3>
    <table>
      <thead>
        <tr><th>IP</th><th>Brand</th><th>Model</th><th style="width:220px">Actions</th></tr>
      </thead>
      <tbody id="tblSwitch">
        <tr><td colspan="4" class="muted">no data</td></tr>
      </tbody>
    </table>
  </div>

  <div class="panel" style="margin-top:16px">
    <h3 style="margin:0 0 6px">Camera Details</h3>
    <table>
      <thead id="theadUnified">
        <!-- JS가 pre/post 단계별로 동적으로 생성 -->
      </thead>
      <tbody id="tblUnified">
        <tr><td class="muted">no data</td></tr>
      </tbody>
    </table>
  </div>

  <script src="/web/oms-camera.js" defer></script>
</body>
</html>

